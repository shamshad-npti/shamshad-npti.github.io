var Timer=function(){var g=this;g.start=0;g.elapse=0;g.reset=function(){g.start=(new Date).getTime()};g.record=function(){g.elapse=(new Date).getTime()-g.start}},LinkedList=function(){function g(a){a.next.prev=a.prev;a.prev.next=a.next;a.next=a.prev=null;a.elem=null}var d=function(a,f,c){this.elem=a;this.next=f;this.prev=c},a=this;a.head=new d(null,null,null);a.head.next=a.head.prev=a.head;a.shift=function(){g(a.head.next)};a.pop=function(){g(a.head.prev)};a.push=function(b){b=new d(b,a.head,a.head.prev);
a.head.prev.next=b;a.head.prev=b};a.unshift=function(b){b=new d(b,a.head.next,a.head);a.head.next.prev=b;a.head.next=b};a.merge=function(b){b.isEmpty()||(a.head.prev.next=b.head.next,b.head.next.prev=a.head.prev,b.head.prev.next=a.head,a.head.prev=b.head.prev,b.destroy())};a.isEmpty=function(){return a.head===a.head.next};a.destroy=function(){a.head=new d(null,null,null)};a.toArray=function(){for(var b=a.head.next,f=[];b!=a.head;)f.push(b.elem),b=b.next;return f};a.remove=function(a){a instanceof
d&&g(a)};a.forEach=function(b){for(var f=a.head.next,c;f!==a.head;)c=f.next,b(f.elem,f),f=c}},Point=function(g,d,a){var b=this;b.x=g;b.y=d;b.lineTo=a;b.equals=function(a){var c=b.x,d=a.x;if(c=c===d?!0:c-1E-6<d&&d<c+1E-6)c=b.y,a=a.y,c=c===a?!0:c-1E-6<a&&a<c+1E-6;return c}},PointList=function(g,d){var a=this;a.start=g;a.end=d;a.start.lineTo=!1;a.end.lineTo=!0;a.points=new LinkedList;a.merge=function(b){a.points.push(a.end);b.start.lineTo=!0;a.points.push(b.start);a.end=b.end;0!=b.points.length&&a.points.merge(b.points)};
a.push=function(b){b.lineTo=!0;a.points.push(a.end);a.end=b};a.unshift=function(b){b.lineTo=!1;a.start.lineTo=!0;a.points.unshift(a.start);a.start=b}},Rectangle=function(g){var d=this;d.eval=[0,0,0,0];d.rect=[0,0,0,0];d.x=0;d.y=0;d.children=null;d.status=null;d.singular=!1;d.func=g;d.copy=function(a){for(var b=0;4>b;b++)d.eval[b]=a.eval[b],d.rect[b]=a.rect[b];d.x=a.x;d.y=a.y;d.singular=a.singular};d.set=function(a,b,f,c,q){d.x=a;d.y=b;d.rect[2]=f;d.rect[3]=c;d.singular=q};d.split=function(){if(null===
d.children){d.children=[];for(var a=0;4>a;a++)d.children.push(new Rectangle(d.func))}for(var b=d.children,f=.5*d.rect[2],c=.5*d.rect[3],a=0;4>a;a++)b[a].copy(d),b[a].rect[2]=f,b[a].rect[3]=c;b[1].rect[0]+=f;b[2].rect[0]+=f;b[2].rect[1]+=c;b[3].rect[1]+=c;b[0].eval[1]=d.func(b[1].rect[0],b[1].rect[1]);b[0].eval[2]=d.func(b[2].rect[0],b[2].rect[1]);b[0].eval[3]=d.func(b[3].rect[0],b[3].rect[1]);b[1].eval[2]=d.func(b[2].rect[0]+f,b[2].rect[1]);b[2].eval[3]=d.func(b[2].rect[0],b[2].rect[1]+c);b[1].eval[0]=
b[0].eval[1];b[1].eval[3]=b[0].eval[2];b[2].eval[0]=b[0].eval[2];b[2].eval[1]=b[1].eval[2];b[3].eval[0]=b[0].eval[3];b[3].eval[1]=b[0].eval[2];b[3].eval[2]=b[2].eval[3];return b};d.x1=function(){return d.rect[0]};d.y1=function(){return d.rect[1]};d.x2=function(){return d.rect[0]+d.rect[2]};d.y2=function(){return d.rect[1]+d.rect[3]}},Implicit=function(g,d){function a(a){for(var c=0,b=0,d=0,e=!0,f=0;4>f;f++){if(!isFinite(a.eval[f])||isNaN(a.eval[f])){e=!1;break}0>a.eval[f]?d++:0<a.eval[f]?b++:c++}a.status=
{pos:b,neg:d,zero:c,valid:e,empty:!e||4<=(c+1|b|d)}}function b(a,c,b,f){b=-f/(b-f);return 0<=b&&1>=b?b*(a-c)+c:.5*(a+c)}function f(a,b,f,d){c.pts[0]=new Point(a,b,!1);c.pts[1]=new Point(f,d,!0);return 1}var c=this,q=16,r=new Timer;c.func=g;c.finish=d;c.grid=null;c.temp=null;c.plotDepth=0;c.segmentCheckDepth=0;c.openList=[];c.segments=[];c.sw=0;c.sh=0;c.pts=[null,null];c.abortList=function(){for(var a=0;a<c.openList.length;a++)c.segments.push(c.openList[a].start),c.segments=c.segments.concat(c.openList[a].points.toArray()),
c.segments.push(c.openList[a].end);c.openList=[]};c.create=function(a){if(a.status.empty)return 0;var d=a.status.zero,q=a.status.neg,g=a.status.pos;if(4<=(d+1|q|g))return 0;var e=a.x1(),h=a.x2(),k=a.y1(),l=a.y2(),n=a.eval[0],m=a.eval[1],p=a.eval[2];a=a.eval[3];switch(d){case 0:d=0;if(q===g&&!(0>n*p))return 5;0>n*m&&(c.pts[d++]=new Point(b(e,h,n,m),k,0!==d));0>m*p&&(c.pts[d++]=new Point(h,b(k,l,m,p),0!==d));0>p*a&&(c.pts[d++]=new Point(b(e,h,a,p),l,0!==d));0>a*n&&(c.pts[d++]=new Point(e,b(k,l,n,a),
0!==d));return 1;case 1:if(3===q||3===g){if(0===n)return f(e,k,e,k);if(0===m)return f(h,k,h,k);if(0===a)return f(e,l,h,l);if(0===p)return f(h,l,h,l)}if(0===n)return 0>a*p?f(e,k,b(e,h,a,p),l):0>m*p?f(e,k,h,b(k,k,m,p)):0;if(0===m)return 0>a*p?f(b(e,h,a,p),l,h,k):0>a*n?f(e,b(k,l,n,a),h,k):0;if(0===p)return 0>n*m?f(b(e,h,n,m),k,h,l):0>n*a?f(e,b(k,l,n,a),h,l):0;if(0===a){if(0>n*m)return f(e,l,b(e,h,n,m),k);if(0>m*p)return f(e,l,h,b(k,l,m,p))}return 0;case 2:if(2===g||2===q)if(0===n){if(0===m)return f(e,
k,h,k);if(0===a)return f(e,k,e,l)}else{if(0===p){if(0===m)return f(h,k,h,l);if(0===a)return f(e,l,h,l)}}else{if(0===m&&0===a)return f(e,l,h,k);if(0===n&&0===p)return f(e,k,h,l)}return 0}};c.append=function(a){a=c.create(a);if(1===a){if(c.pts[0].x>c.pts[1].x){var b=c.pts[0];c.pts[0]=c.pts[1];c.pts[1]=b}for(var d=b=-1,f=0;f<c.openList.length;f++)if(c.pts[1].equals(c.openList[f].start)){b=f;break}for(f=0;f<c.openList.length;f++)if(c.pts[0].equals(c.openList[f].end)){d=f;break}-1!==b&&-1!==d?(c.openList[d].merge(c.openList[b]),
c.openList.splice(b,1)):-1!==b?c.openList[b].unshift(c.pts[0]):-1!==d?c.openList[d].push(c.pts[1]):c.openList.push(new PointList(c.pts[0],c.pts[1]));c.openList.length>q&&c.abortList()}return a};c.update=function(b,d,f,g,e,h){b-=.25*Math.PI/e;c.sw=Math.min(32,Math.floor(e/8));c.sh=Math.min(32,Math.floor(h/8));if(0!=c.sw&&0!=c.sh){if(null===c.grid||c.grid.length!==c.sh||c.grid[0].length!==c.sw)for(c.grid=[],e=0;e<c.sh;e++){var k=[];for(h=0;h<c.sw;h++)k.push(new Rectangle(c.func));c.grid.push(k)}null===
c.temp&&(c.temp=new Rectangle(c.func));f=(f-b)/c.sw;g=(g-d)/c.sh;var k=[],l=[],n=[];for(e=0;e<=c.sw;e++)l.push(b+e*f);for(e=0;e<=c.sh;e++)n.push(d+e*g);for(e=0;e<=c.sw;e++)k.push(c.func(l[e],n[0]));r.reset();for(e=1;e<=c.sh;e++){d=c.func(l[0],n[e]);for(h=1;h<=c.sw;h++){b=c.func(l[h],n[e]);var m=c.grid[e-1][h-1];m.set(h-1,e-1,f,g,!1);m.rect[0]=l[h-1];m.rect[1]=n[e-1];m.eval[0]=k[h-1];m.eval[1]=k[h];m.eval[2]=b;m.eval[3]=d;m.status=a(m);k[h-1]=d;d=b}k[c.sw]=d}r.record();10>=r.elapse?(c.plotDepth=2,
c.segmentCheckDepth=1,q=48):(c.plotDepth=1,c.segmentCheckDepth=0,q=24);for(e=0;e<c.sh;e++)for(h=0;h<c.sw;h++)c.grid[e][h].singular||0==c.grid[e][h].status||(c.temp.copy(c.grid[e][h]),c.plot(c.temp,0),c.grid[e][h].status=-1);r.record();if(!(500<=r.elapse)){200<=r.elapse&&(--c.plotDepth,--c.segmentCheckDepth);for(b=0;4>b;b++)for(e=0;e<c.sh;e++)for(h=0;h<c.sw;h++)c.grid[e][h].singular&&-1!=c.grid[e][h].status&&(c.temp.copy(grid[e][h]),c.plot(temp,0),c.grid[e][h].status=-1);c.abortList();c.finish(c.segments)}}};
c.makeTree=function(a,b){var d=a.split();c.plot(d[0],b);c.plot(d[1],b);c.plot(d[2],b);c.plot(d[3],b)};c.plot=function(b,d){d<c.segmentCheckDepth?c.makeTree(b,d+1):(a(b),b.status.empty||(d>=c.plotDepth?5===c.append(b,4===d)&&4>d&&c.makeTree(b,d+1):c.makeTree(b,d+1)))}},CanvasPlotter=function(g,d){var a=this;a.canvas=g;a.func=d;a.style=function(a,d){var c=a.getAttribute(d);return void 0!==c&&null!==c?c:""}(g,"style");a.x1=-10;a.x2=10;a.y1=-10;a.y2=10;a.ctx=g.getContext("2d");a.color="green";a.axisColor=
"#222";a.gridColor="#ccc";a.clearColor="#efefef";a.px=300;a.py=300;a.tx=0;a.ty=0;a.isdown=!1;a.mouseX=0;a.mouseY=0;a.working=!1;a.mousedown=function(b){0==b.button&&(a.processEvt(b),a.mouseX=a.mx,a.mouseY=a.my,a.isdown=!0)};a.mousemove=function(b){if(a.isdown){a.processEvt(b);b=a.mx-a.mouseX;var d=a.my-a.mouseY;a.mouseX=a.mx;a.mouseY=a.my;b/=a.tx;d/=a.ty;a.x1-=b;a.x2-=b;a.y1+=d;a.y2+=d;a.canvas.style=a.style+";cursor: move;";a.update()}};a.mouseup=function(b){a.isdown&&(a.processEvt(b),a.mx-=a.mouseX,
a.my-=a.mouseY,a.mx/=a.tx,a.my/=a.ty,a.x1-=a.mx,a.x2-=a.mx,a.y1+=a.my,a.y2+=a.my,a.isdown=!1,a.canvas.style=a.style,a.update())};a.processEvt=function(b){var d=a.canvas.getBoundingClientRect();a.mx=a.canvas.width/d.width*(b.clientX-d.left);a.my=a.canvas.height/d.height*(b.clientY-d.top)};a.finish=function(b){a.ctx.setTransform(a.tx,0,0,-a.ty,-a.x1*a.tx,a.y2*a.ty);a.lineWidth=1/Math.max(Math.abs(a.tx),Math.abs(a.ty));a.ctx.beginPath();a.ctx.rect(a.x1,a.y1,a.x2-a.x1,a.y2-a.y1);a.ctx.fillStyle=a.clearColor;
a.ctx.fill();a.ctx.beginPath();a.ctx.moveTo(0,a.y1);a.ctx.lineTo(0,a.y2);a.ctx.moveTo(a.x1,0);a.ctx.lineTo(a.x2,0);a.ctx.lineWidth=.5*a.lineWidth;a.ctx.strokeStyle=a.axisColor;a.ctx.stroke();a.ctx.beginPath();for(var d=(a.x2-a.x1)/10,c=(a.y2-a.y1)/10,g=d;g<a.x2;g+=d)a.ctx.moveTo(g,a.y1),a.ctx.lineTo(g,a.y2);for(g=-d;g>a.x1;g-=d)a.ctx.moveTo(g,a.y1),a.ctx.lineTo(g,a.y2);for(g=c;g<a.y2;g+=c)a.ctx.moveTo(a.x1,g),a.ctx.lineTo(a.x2,g);for(g=-c;g>a.y1;g-=c)a.ctx.moveTo(a.x1,g),a.ctx.lineTo(a.x2,g);a.ctx.lineWidth=
.5*a.lineWidth;a.ctx.strokeStyle=a.gridColor;a.ctx.stroke();a.ctx.beginPath();for(d=0;d<b.length;d++)b[d].lineTo?a.ctx.lineTo(b[d].x,b[d].y):a.ctx.moveTo(b[d].x,b[d].y);a.ctx.strokeStyle=a.color;a.ctx.lineWidth=2*a.lineWidth;a.ctx.stroke()};a.update=function(){a.px=g.scrollWidth;a.py=g.scrollHeight;a.tx=a.px/(a.x2-a.x1);a.ty=a.py/(a.y2-a.y1);a.plot=new Implicit(a.func,a.finish);a.plot.update(a.x1,a.y1,a.x2,a.y2,a.px,a.py)};a.canvas.addEventListener("mousedown",a.mousedown,!1);a.canvas.addEventListener("mouseup",
a.mouseup,!1);a.canvas.addEventListener("mousemove",a.mousemove,!1);document.body.addEventListener("mouseup",function(){a.isdown=!1},!1)};
